<!DOCTYPE html>
<!--[if lt IE 7]> <html class="lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Question Category - Master</title>
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
   <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/animate.css@3.5.2/animate.min.css">
  <!-- or -->
  <link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">


  <!-- Font links here -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Arimo" rel="stylesheet">  
<style>
/*blue-4cdef5
green-a4d555
blue-grey -424a5d

sky blue-Dashgum - 68dff0*/

/* 1. Green- 4abdac
      Red - fc4a1a
      Orange- F7b733
      grey - DFDCe3
    */



/*----------------------------------------------CSS for nav bar -----------------------------------------------*/   

nav{
  /*background-color:#4abdac;*/
/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#77c9d4+0,77c9d4+0,57bc90+100 */
background: #57bc90; /* Old browsers */
background: -moz-linear-gradient(-45deg, ##77cad5 0%, #77cad5 0%, #57bc90 100%); /* FF3.6-15 */
background: -webkit-linear-gradient(-45deg, #77cad5 0%,#77cad5 0%,#57bc90 100%); /* Chrome10-25,Safari5.1-6 */
background: linear-gradient(135deg, #77cad5 0%,#77cad5 0%,#57bc90 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#77cad5', endColorstr='#57bc90',GradientType=1 ); /* IE6-9 fallback on horizontal gradient */
}

nav ul li.active{
  background-color:#77cad5;
}

nav ul li:hover{
   background-color:#77cad5;
}

nav ul li a:hover{
  background-color:#77cad5;
  opacity:1;
  color:white;
 /* border-bottom:4px solid #57bc90;*/
}

.brand-logo{
  margin-left:10px;
  margin-top:2px;
}


/*--------------*Mobile nav bar code----------------------------*/

.side-nav{
  /*background-color:#4abdac;*/
/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#77c9d4+0,77c9d4+0,57bc90+100 */
background: #57bc90; /* Old browsers */
background: -moz-linear-gradient(-45deg, #77c9d4 0%, #77c9d4 0%, #57bc90 100%); /* FF3.6-15 */
background: -webkit-linear-gradient(-45deg, #77c9d4 0%,#77c9d4 0%,#57bc90 100%); /* Chrome10-25,Safari5.1-6 */
background: linear-gradient(135deg, #77c9d4 0%,#77c9d4 0%,#57bc90 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#77c9d4', endColorstr='#57bc90',GradientType=1 ); /* IE6-9 fallback on horizontal gradient */
}

.side-nav a>li{
  color:white;
}


/*------------------------------------------------CSS for side nav bar----------------------------------------------------*/


#sidebar{
  color:#77cad5;
  background-color:white;
}

.sidebaritem:hover{
   background-color:#77c9d4/*68dff0*/;
   color:white;
   transition: all .35s ease-in;
  /*background-position: 0 0;*/
}

.sidebaritem{
  padding:15px 30px;
  cursor:pointer;
  border-bottom: 1px dotted #77cad5;
}


 #display_image img{
    display:block;
    margin: 0 auto;
 }

 #display_name{
  padding:15px 5px;
  text-align:center;
  border-bottom: 1px dotted #77cad5;
  /*border-bottom: 1px solid grey*/
 }

.verticalalign{
  vertical-align: middle;
}
/*------------------------------------------------CSS for main content----------------------------------------------------*/
#submit_master{
  margin:10px;
  width:100%;

}
/*------------------------------------------------CSS for footer----------------------------------------------------*/

.page-footer{
  background-color:#66b9bf;
  /* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#77c9d4+0,77c9d4+0,57bc90+100 */
background: #57bc90; /* Old browsers */
background: -moz-linear-gradient(-45deg, #57bc90 0%, #57bc90 0%, #77c9d4 100%); /* FF3.6-15 */
background: -webkit-linear-gradient(-45deg, #57bc90 0%,#57bc90 0%,#77c9d4 100%); /* Chrome10-25,Safari5.1-6 */
background: linear-gradient(135deg, #57bc90 0%,#57bc90 0%,#77c9d4 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#77c9d4', endColorstr='#57bc90',GradientType=1 ); /* IE6-9 fallback on horizontal gradient */
}

.row{
  margin-bottom:0px;
}


/*------------------------------------------------CSS for body, main ----------------------------------------------------*/
 body {
     display: flex;
     min-height: 100vh;
     flex-direction: column;
     font-family: 'Arimo',sans-serif;
 }
 main {
     flex: 1 0 auto;
 }



</style>

  <!-- Compiled and minified JavaScript -->
  
  <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>      
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
  <!-- <link rel="stylesheet" href="css/style.css"> -->
  <!--[if lt IE 9]><script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.17.0/axios.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.12/jquery.transit.min.js"></script>
   <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>


<body>
  <!-- Header -->
  
   <nav>
    <div class="nav-wrapper">
      <a href="#" class="brand-logo"><!-- <img src='../logo.png' width='60vh'> --></a>
      <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li class=''><a href="profile.html">Profile</a></li>
        <li><a href="courses.html">Available Courses</a></li>
        <li><a href="coursedetail.html">Your Courses</a></li>
        <li><a href="logout.html">Logout</a></li>
      </ul>

       <ul class="side-nav" id="mobile-demo">
        <li><a href="profile.html">Profile</a></li>
        <li><a href="courses.html">Available Courses</a></li>
        <li><a href="coursedetail.html">Your Courses</a></li>
        <li><a href="logout.html">Logout</a></li>
        <li><a class='back' href="">Back</a></li>
      </ul>
    </div>
  </nav>
  <!-- Header ends here -->
  <!-- Page content starts here -->
  <main>
    <div class='row'>
    <!-- Side Nav Bar -->
    <div class="col s12 m2 l2" id='sidebar'>
      <div class='inside_sidebar'>
        <ul>

          <li id='display_image' class=''><!-- <img src="../avatar.jpg" width='50%' alt="" class="circle responsive-img"> --></li>
          <li id='display_name' class=''>Welcome Super Admin</li>
          <li id='item2' class='sidebaritem'> <i class="tiny material-icons verticalalign">developer_board</i>&nbsp;&nbsp;<span class='verticalalign'>Your News</span></li>
          <li id='item3' class='sidebaritem'> <i class="tiny material-icons verticalalign">import_contacts</i>&nbsp;&nbsp;<span class='verticalalign'>Your Courses</span></li>
           <li id='item4' class='sidebaritem'> <i class="tiny material-icons verticalalign">account_circle</i>&nbsp;&nbsp;<span class='verticalalign'>Your Profile</span></li>
           <li id='item5' class='sidebaritem'> <i class="tiny material-icons verticalalign">fingerprint</i>&nbsp;&nbsp;<span class='verticalalign'>Your Password</span></li>
        </ul>
      </div>
    </div>

    <!-- Side Nav Bar Ends here -->
        
    <!-- Main Content starts here-->
      <div class="col s12 m10 l10" id='maincontent'>
      <!-- Main text starts here -->
      <div id='main_text'>
        <div class='row'>
          <div class='col s12 m12 l12' id='category_form'>
            <!-- 1. Exam Category Dropdown - MBA , Banking etc.. -->
            <div class="input-field col s12 m3 l3 exam_category_div">
              <div class="input-field col s12 m12 l12 exam_category"><b>Exam Category</b></div>
              <div class="input-field col s12 m12 l12 exam_category_button"></div>
            </div>
            <!-- 2. Exam Name Dropdown - CAT , XAT etc.. -->
            <div class="input-field col s12 m3 l3 exam_name_div">
              <div class="input-field col s12 m12 l12 exam_name"><b>Exam Name</b></div>
              <div class="input-field col s12 m12 l12 exam_name_button"></div>
            </div>
            <!-- 3. Exam Section Dropdown - QA, VA etc.. -->
            <div class="input-field col s12 m3 l3 exam_sections_div">
              <div class="input-field col s12 m12 l12 exam_sections"><b>Exam Sections</b></div>
              <div class="input-field col s12 m12 l12 exam_sections_button"></div>
            </div>
             <!--  4. Exam Topics Input Fields-->
            <div class="input-field col s12 m3 l3 exam_topics_div">
              <div class="input-field col s12 m12 l12 exam_topics"><b>Exam Topics</b></div>
              <div class="input-field col s12 m12 l12 exam_topics_button"></div>
            </div>
          </div>
          <div class='col s12 m12 l12' id='category_form_submit'>
            <div class='col s12 m12 l12'><a class="waves-effect waves-light btn submit_master" id='submit_master' width='100%'>Submit master form</a></div>
            <div id='category_form_submit_status'></div>
          </div>
        </div>
      </div>
    <!-- Main text ends here -->
  </div>
      <!-- Main Content ends here-->
    </div>
  </main>
<!-- Footer starts here -->
     <footer class="page-footer">
          <div class="container">
            <div class="row">
              <div class="col l6 s12">
                <h5 class="white-text">Footer Content</h5>
                <p class="grey-text text-lighten-4">You can use rows and columns here to organize your footer content.</p>
              </div>
              <div class="col l4 offset-l2 s12">
                <h5 class="white-text">Links</h5>
                <ul>
                  <li><a class="grey-text text-lighten-3" href="#!">Link 1</a></li>
                  <li><a class="grey-text text-lighten-3" href="#!">Link 2</a></li>
                  <li><a class="grey-text text-lighten-3" href="#!">Link 3</a></li>
                  <li><a class="grey-text text-lighten-3" href="#!">Link 4</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="footer-copyright">
            <div class="container">
            © 2014 Copyright Text
            <a class="grey-text text-lighten-4 right" href="#!">More Links</a>
            </div>
          </div>

        </footer>
  <!-- Footer ends here -->
</body>
<script>
  // Global Variables declaration
var user_id = ''
var user_details = ''
var formData =  new FormData();
 var category_master
 var section_counter = 1

$(document).ready(function(){
//MaterializeCSS JS code
$(".button-collapse").sideNav();

$('#mobile-demo .back').click(function(){
  $('.button-collapse').sideNav('hide');
})



//To adjust height of side navbar 
  adjustHeight()

//Fetch the category from master
fetch_category_masterlist()


function add_topic_input(exam_array,selector,label,value=''){
  var html_string = '<div class="input-field col s12 m12 l12"><input type="text" id="autocomplete-input" class="autocomplete" value="'+value+'"></div>'
  $(selector).append("<br/>"+html_string)
}


$(document).on('click', '.add_button', function(){
  //Get the ID to know the section number
  var add_id = $(this).attr('id').split('_')
  add_topic_input([],'.exam_'+add_id[0],'label','')
})

function create_required_inputs(exam_array,selector,label,id){
  for(i=0;i<exam_array.length;i++){
    //Create an input field
    add_topic_input(exam_array,selector,label,exam_array[i])
  }
  $(selector+'_button').append("<div class='col s8 m8 l8'><a class='waves-effect waves-light btn add_button' id='"+id+"'>Add Topic</a></div>")
}

function create_master_form(){
   if (category_master['Exam_Category']){
    //1. Exam category list
    create_required_inputs(category_master['Exam_Category'].split('||'),'.exam_category','Exam Category','category_button')
    //2. Exam Name  list
    create_required_inputs(category_master['Exam_Name'].split('||'),'.exam_name','Exam Name','name_button')
    //3. Exam Section list
    create_required_inputs(category_master['Exam_Sections'].split('||'),'.exam_sections','Exam Section','sections_button')
    //4. Exam Topics list
    create_required_inputs(category_master['Exam_Topics'].split('||'),'.exam_topics','Add a Topic','topics_button')
  }else{
    //Error in axios call. 
    console.log('error')
  }
}
 

$(window).resize(function(){
  //To adjust height of side navbar 
  adjustHeight()
    });

function fetch_category_masterlist(){
  axios({
      method: 'get',
      url: 'http://127.0.0.1:8000/question/qcdetail/2/',
      }).then(function(response){
      //Successful response
      if(response.data){
      //Received the data
      category_master = response.data
      create_master_form()
      }
      }).catch(function(error){
      return error.response
      });
}


$(window).scroll(function(){
  if($('#sidebar').width() != $('#maincontent').width()){
    //It means screen is not on small mode and hence fix side bar
    fixSidebar()
  }
  });

  function adjustHeight(){
    if($('#sidebar').width() <= $('#maincontent').width()-1){
      //Sidebar is smaller than maincontent and hence its not on small mode
      if($('#sidebar').height()<=$('#maincontent').height()){
        //Sidebar height needs to be set equal to maincontent
        $('#sidebar').css('min-height',$('#maincontent').height())
      }else{
        //Sidebar is taller than main content and need to ensure that both occupy full space with footer sticking to base
         $('#sidebar').css('min-height',$(document).height()-$('nav').height()-$('footer').height())
         $('#maincontent').css('min-height',$(document).height()-$('nav').height()-$('footer').height())
      }
    }else{
      //Sidebar filled entire width of the screen and hence height should be simple 100%
      $('#sidebar').css('min-height','100%')
    }
    
    }

  function fixSidebar(){
    //Find the location of screen from top
    var current =  $(window).scrollTop();
    var navheight = $('nav').height()
    if(current > navheight){
      $('.inside_sidebar').css('margin-top',current-navheight)
    }else{
      $('.inside_sidebar').css('margin-top','0px')
    }
    
  }




  function parseJwt (token) {
    var base64Url = token.split('.')[1];
    var base64 = base64Url.replace('-', '+').replace('_', '/');
    return JSON.parse(window.atob(base64));
  };

  function create_submit_masterdata(selector){
    var category_input_array = $(selector) 
    var exam_category_data = ''
   for(i=0;i<category_input_array.length;i++){
    if(i == category_input_array.length-1){
      exam_category_data += $(category_input_array[i]).val()
    }else{
      exam_category_data += $(category_input_array[i]).val()+'||'
    }
   }
   return exam_category_data
  }

function getCSRFToken() {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            if (cookie.substring(0, 10) == ('csrftoken' + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(10));
                break;
            }
        }
    }
    return cookieValue;
}


 //2. Submit the master form
$('#submit_master').click(function(){
   //1. Collect all the inputs for Exam_category:
   

  //Input fields updating
  var exam_category = create_submit_masterdata('.exam_category input')
  var exam_name = create_submit_masterdata('.exam_name input')
  var exam_sections = create_submit_masterdata('.exam_sections input')
  var exam_topics = create_submit_masterdata('.exam_topics input')

/*  formData.append("Exam_Category", exam_category);
  formData.append("Exam_Name", exam_name);
  formData.append("Exam_Sections", exam_sections);
  formData.append("Exam_Topics", exam_topics);
  formData.append("Is_Master", 1);*/

  axios({
  method: 'put',
  url: 'http://127.0.0.1:8000/question/qcupdate/2/',
  /*headers: { Authorization: "JWT "+localStorage.getItem('key_id') },*/
  headers: {"X-CSRFToken": getCSRFToken()},
  data: {
    Exam_Category:exam_category,
    Exam_Name:exam_name,
    Exam_Sections:exam_sections,
    Exam_Topics:exam_topics,
    Is_Master:1,
  }
}).then(function(response){
    //Success
    $('#category_form_submit_status').html('<span style="color:green;">Updated Successfully!!</span>')
  console.log(response.data)
  }).catch(function(error){
    //Failure
    $('#category_form_submit_status').append('<span style="color:red;">Update Failed. Check error !!</span>')
    console.log(error.response)
  });

})  

})

</script>

</html>